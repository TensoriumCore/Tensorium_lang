
version: 1

project:
  name: Tensorium_lang
  description: >
    Tensorium_lang is a domain-specific language and compiler frontend for
    tensor calculus and numerical relativity (Einstein equations, BSSN-like
    systems). It is implemented in C++20 and built on top of MLIR/LLVM 20.

context:
  include:
    - CMakeLists.txt
    - compile_commands.json
    - include/**
    - lib/**
    - tools/**
    - tests/**
    - run_test.sh
    - README.md
  exclude:
    - build/**
    - .git/**
    - **/*.o
    - **/*.a
    - **/*.so

commands:
  build:
    description: Configure and build Tensorium_lang in Debug mode
    run: |
      cmake -S . -B build \
        -DLLVM_DIR=/opt/local/libexec/llvm-20/lib/cmake/llvm \
        -DMLIR_DIR=/opt/local/libexec/llvm-20/lib/cmake/mlir \
        -DCMAKE_BUILD_TYPE=Debug \
        -DCMAKE_CXX_FLAGS="-O0 -g"
      cmake --build build -j

  run:
    description: Run Tensorium_cc on a Tensorium source file (.tn)
    run: |
      ./build/tools/driver/Tensorium_cc \
        --tensorium-stencil-lower \
        --tensorium-dissipation \
        --tensorium-einstein-lower \
        --tensorium-einstein-analyze-einsum \
        --tensorium-einstein-canonicalize \
        --tensorium-einstein-validate \
        --dump-mlir \
        {{file}}

  test:
    description: Alias for run, expects a file from tests/
    run: |
      ./build/tools/driver/Tensorium_cc \
        --tensorium-stencil-lower \
        --tensorium-dissipation \
        --tensorium-einstein-lower \
        --tensorium-einstein-analyze-einsum \
        --tensorium-einstein-canonicalize \
        --tensorium-einstein-validate \
        --dump-mlir \
        {{file}}
